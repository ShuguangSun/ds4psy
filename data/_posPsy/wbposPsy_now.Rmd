---
title: "Web-based Positive Psychology Interventions"
author: "lmw & hn"
date: "31 Oktober 2018"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Web-based Positive Psychology Interventions: A Reexamination of Effectiveness

## Source

- Woodworth, R. J., O’Brien-Malone, A., Diamond, M. R. and Schüz, B. (2018). 
Data from, ‘Web-based Positive Psychology Interventions: A Reexamination of Effectiveness’. 
_Journal of Open Psychology Data_, _6_: 1. 
DOI: <https://doi.org/10.5334/jopd.35> 

- See <https://openpsychologydata.metajnl.com/articles/10.5334/jopd.35/> for details. 

- The dataset is available from figshare at <https://doi.org/10.6084/m9.figshare.1577563.v1>.


## Preparation

```{r 2_packages, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
library(tidyverse)
library(readxl)
library(knitr)
```

## Study data

The study data is stored in 2 seperate files: `participant-info.csv` & `ahi-cesd.csv`

### File `participant-info.csv`

Contains _demographic information_ on participants:

* `id`: participant id

* `intervention`: 3 positive psychology interventions, plus 1 control condition: 

    - 1 = “Using Signature Strengths”, 
    - 2 = “Three Good Things”, 
    - 3 = “Gratitude Visit”, 
    - 4 = “Recording early memories” (control condition).  

* `sex`: 

    - 1 = female, 
    - 2 = male. 

* `age`: participant's age (in years). 

* `educ`: level of education:  

    - 1 = Less than Year 12, 
    - 2 = Year 12,
    - 3 = Vocational training, 
    - 4 = Bachelor’s degree, 
    - 5 = Postgraduate degree.

* `income`: 

    - 1 = below average, 
    - 2 = average, 
    - 3 = above average.

### File `ahi-cesd.csv`

Contains data of the 24 items of the _Authentic Happiness Inventory_ (AHI) and to the 20 items of the _Center for Epidemiological Studies Depression_ (CES-D) scale. 

* `id`: Particpant ID

* `occasion`: Measurement occasion: 

    - 0 = Pretest (i.e., at enrolment), 
    - 1 = Posttest (i.e., 7 days after pretest), 
    - 2 = 1-week follow-up, (i.e., 14 days after pretest, 7 days after posttest), 
    - 3 = 1-month follow-up, (i.e., 38 days after pretest, 31 days after posttest), 
    - 4 = 3-month follow-up, (i.e., 98 days after pretest, 91 days after posttest), 
    - 5 = 6-month follow-up, (i.e., 189 days after pretest, 182 days after posttest).

* `elapsed.days`: time since enrolment measured in fractional days	

* `intervention`: intervention group

* `ahi01`--`ahi24`: responses on 24 AHI items

* `cesd01`--`cesd20`: responses on 20 CES-D items

* `ahiTotal`: total AHI score

* `cesdTotal`: total CES-D score


### Step 1: Import data

```{r 3_read_data, echo = TRUE, eval = FALSE}
## Lisa:

ahi_cesd <- read_delim("~/Uni/7. Semester/HiWi/Data/Web-based positive psychology interventions/ahi-cesd.csv", ";", escape_double = FALSE, trim_ws = TRUE)

participant_info <- read_delim("~/Uni/7. Semester/HiWi/Data/Web-based positive psychology interventions/participant-info.csv", ";", escape_double = FALSE, trim_ws = TRUE)
```

```{r 3_read_data_hans, echo = TRUE, eval = TRUE}
## Hans: 

# library(data.table)

## Get & set current path:
# cur.path <- dirname(rstudioapi::getActiveDocumentContext()$path)
# cur.path
# setwd(cur.path) # set to current directory

my_path <- "/Users/hneth/Desktop/stuff/Dropbox/_code/R/_teachR/ds4psy/data/_posPsy"

ahi_cesd <- read_delim(paste0(my_path, "/ahi-cesd.csv"), ";", 
                       escape_double = FALSE, trim_ws = TRUE)
participant_info <- read_delim(paste0(my_path, "/participant-info.csv"), ";", 
                               escape_double = FALSE, trim_ws = TRUE)


## Save data files:
## save(participant_info, file = "./data/p_info.RData")
# write_csv(participant_info, path = "/Users/hneth/Desktop/stuff/Dropbox/_code/R/_teachR/ds4psy/data/posPsy_participants.csv")

## Restore data files:
# p_info <- read_csv(file = "/Users/hneth/Desktop/stuff/Dropbox/_code/R/_teachR/ds4psy/data/posPsy_participants.csv")
# p_info <- read_csv(file = "http://rpository.com/ds4psy/data/posPsy_participants.csv")
# p_info

# all.equal(participant_info, p_info)
```

### Step 2: Inspect data

```{r inspect_data, echo = TRUE, eval = TRUE}
glimpse(participant_info)

glimpse(ahi_cesd)

## How many occasions (lines) are there for each participant?
# ahi_cesd
occasions_pp <- ahi_cesd %>%
  group_by(id) %>%
  summarise(n = n())

knitr::kable(head(occasions_pp))

## How many participants with all 6 occasions?

occasions_pp %>%
  filter(n == 6) %>%
  nrow()
```

### Step 3: Combine data in one tibble

Note that `ahi_cesd` consists of several blocks of data (one per `occasion`, including all participants still participating in this occasion).

#### Step 3.1.: Split `ahi_cesd` into parts

Edit `ahi_cesd`: Filter each occasion into a separate data file and combine them afterwards:

Goal: 1 block for each `occasion`, 1 row per participant

```{r slice_dice, echo = TRUE, eval = TRUE}
# Create individual tibbles for every observation 
#  to later combine them using full_join()
ahi_cesd_0 <- ahi_cesd%>%
  group_by(id, occasion)%>%
  filter(occasion == 0)

ahi_cesd_1 <- ahi_cesd%>%
  group_by(id, occasion)%>%
  filter(occasion == 1)

ahi_cesd_2 <- ahi_cesd%>%
  group_by(id, occasion)%>%
  filter(occasion == 2)

ahi_cesd_3 <- ahi_cesd%>%
  group_by(id, occasion)%>%
  filter(occasion == 3)

ahi_cesd_4 <- ahi_cesd%>%
  group_by(id, occasion)%>%
  filter(occasion == 4)

ahi_cesd_5 <- ahi_cesd%>%
  group_by(id, occasion)%>%
  filter(occasion == 5)
```

Now we can join the 6 parts by participant `id`:

```{r join_1, echo = TRUE, eval = TRUE}
# Join parts: 
new1 <- full_join(ahi_cesd_0, ahi_cesd_1, by = "id", suffix = c(".0", ".1"))
new2 <- full_join(new1, ahi_cesd_2, by = "id", suffix = c(".1", ".2"))
new3 <- full_join(new2, ahi_cesd_3, by = "id", suffix = c(".2", ".3"))
new4 <- full_join(new3, ahi_cesd_4, by = "id", suffix = c(".3", "4"))

new_final <- full_join(new4, ahi_cesd_5, by = "id", suffix = c(".4", ".5"))

## check:
# new_final 
```

#### Step 3.2: Combine data sets

Joining `participant_info` with `new_final`: 

```{r join_2, echo = TRUE, eval = TRUE}
complete_data <- full_join(participant_info, new_final, by = "id")

## Check:
# complete_data
dim(complete_data)
```

#### Step 3.3: Remove redundancy

Delete redundant `intervention.*` columns, only retaining the column `intervention`:

```{r remove_redundancy, echo = TRUE, eval = TRUE}
# complete_data <- select(complete_data, -intervention.0)
# complete_data <- select(complete_data, -intervention.1)
# complete_data <- select(complete_data, -intervention.2)
# complete_data <- select(complete_data, -intervention.3)
# complete_data <- select(complete_data, -intervention.4)
# complete_data <- select(complete_data, -intervention.5)
# 
# dim(complete_data)

## Task:Is there an easier way to handle this?
## In 1 line:
complete_data <- select(complete_data, -intervention.0, -intervention.1, -intervention.2, 
                                       -intervention.3, -intervention.4, -intervention.5)
dim(complete_data)
```


### Step 4: Explore data sets

#### Only participant info data

```{r explore_participants, echo = TRUE, eval = TRUE}
# number of participants: 
participant_info %>%
  count()

# number of participants per intervention group: 
participant_info %>%
  group_by(intervention) %>%
  summarise(n = n(), 
            mean_age_i = mean(age, na.rm = TRUE), 
            min_age_i = min(age, na.rm = TRUE), 
            max_age_i = max(age, na.rm = TRUE))

# number of male / female participants: 
participant_info %>%
  group_by(sex) %>%
  summarise(n = n())

# Age distribution: 
ggplot(participant_info) +
  geom_histogram(mapping = aes(age), binwidth = 2, fill = "forestgreen") +
  theme_bw() +
  labs(title = "Distribution of age values")
  
 
# Age distribution by intervention: 
ggplot(participant_info) +
  geom_histogram(mapping = aes(age), binwidth = 5, fill = "forestgreen") +
  theme_bw() +
  labs(title = "Distribution of age values by intervention") +
  facet_grid(.~intervention)

# Distribution of education levels: 
ggplot(participant_info) +
  geom_bar(mapping = aes(educ), fill = "steelblue") + 
  labs(title = "Distribution of education levels") + 
  theme_bw()
```


#### Explore `ahi_i` and `cesd_i` scores

```{r 8, echo = TRUE, eval = TRUE}
ahi_cesd %>% 
  group_by(intervention) %>%
  summarize(mean_ahi_i = mean(ahiTotal, na.rm = TRUE), 
            mean_cesd_i = mean(cesdTotal, na.rm = TRUE))

# ggplot()
```


```{r 9, echo = TRUE, eval = TRUE}

# new variable improvement in ahiTotal/cesdTotal
complete_data %>%
  mutate(improve.ahi = ahiTotal.5 - ahiTotal.0)

complete_data%>%
  mutate(improve.cesd = cesdTotal.5 - cesdTotal.0)

# add to existing data
complete_data <- complete_data%>%
  mutate(improve.ahi = ahiTotal.5 - ahiTotal.0)


complete_data <- complete_data%>%
  mutate(improve.cesd = cesdTotal.5 - cesdTotal.0)


# mean improvement (overall)
complete_data %>%
  summarize(mean_improve_cesd = mean(improve.cesd, na.rm = TRUE), 
            mean_improve_ahi = mean(improve.ahi, na.rm = TRUE))

# mean improvement (per intervention)
## Which intervention group did improve most in ahi and cesd total scores?
complete_data %>%
  group_by(intervention) %>%
  summarize(mean_improve_cesd = mean(improve.cesd, na.rm = TRUE), 
            mean_improve_ahi = mean(improve.ahi, na.rm = TRUE))
```


<!-- eof. --> 