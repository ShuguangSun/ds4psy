---
title: "Functions, with solutions (ds4psy)"
author: "Hansjörg Neth, SPDS, uni.kn"
date: "2019 01 22"
output:
   rmdformats::html_clean: # html_clean html_docco readthedown material #
     code_folding: show # hide
     toc_float: true
     toc_depth: 3
     highlight: default # textmate default kate haddock monochrome #
     lightbox: true # true by default
     fig_width: 7 # in inches
editor_options: 
  chunk_output_type: console # inline
---

<!-- Example of essential commands | ds4psy: Winter/Spring 2018/2019 -->

```{r preamble, echo = FALSE, eval = TRUE, cache = FALSE, message = FALSE, warning = FALSE}
## (a) Housekeeping: -----
rm(list=ls()) # clean all.

## (b) Current file name and path: ----- 
# my_path <- dirname(rstudioapi::getActiveDocumentContext()$path)
# my_path
# setwd(my_path) # set to current directory
setwd("~/Desktop/stuff/Dropbox/_code/R/_teachR/ds4psy/_essentials") # set to current directory
# list.files() # all files + folders in current directory
fileName <- "function.Rmd"

## (c) Packages: ----- 
library(knitr)
library(rmdformats)
library(tidyverse)

## (d) Global options: ----- 
options(max.print = "75")
opts_chunk$set(echo = TRUE,
	             cache = TRUE,
               prompt = FALSE,
               tidy = FALSE,
               collapse = TRUE, # set TRUE in answers 
               comment = "#>",
               message = FALSE,
               warning = FALSE,
               ## Default figure options:
               fig.width = 7, 
               fig.asp = .618, # golden ratio
               out.width = "75%",
               fig.align = "center"
               )
opts_knit$set(width = 75)

## (e) Custom functions: ----- 
source(file = "~/Desktop/stuff/Dropbox/_code/R/_teachR/ds4psy/R/custom_functions.R")
```

# Introduction

This file contains **essential commands** from [Chapter 19: Functions](https://r4ds.had.co.nz/functions.html) of the textbook [r4ds](http://r4ds.had.co.nz) and corresponding examples and exercises. 
A command is considered "essential" when you really need to _know_ it and need to know _how to use_ it to succeed in this course. 

<!-- Table with links: -->

All [ds4psy](http://rpository.com/ds4psy/) essentials so far: 

Nr. | Topic       |
---:|:------------| 
0.  | [Syllabus](http://rpository.com/ds4psy/) | 
1.  | [Basic R concepts and commands](http://rpository.com/ds4psy/essentials/basics.html) | 
2.  | [Visualizing data](http://rpository.com/ds4psy/essentials/visualize.html) | 
3.  | [Transforming data](http://rpository.com/ds4psy/essentials/transform.html) |
4.  | [Exploring data (EDA)](http://rpository.com/ds4psy/essentials/explore.html) | 
5.  | [Tibbles](http://rpository.com/ds4psy/essentials/tibbles.html) |
6.  | [Importing data](http://rpository.com/ds4psy/essentials/import.html) |
7.  | [Tidying data](http://rpository.com/ds4psy/essentials/tidy.html) |
8.  | [Joining data](http://rpository.com/ds4psy/essentials/join.html) |
9.  | **Functions** |
+.  | [Datasets](http://rpository.com/ds4psy/essentials/datasets.html) | 

<!--
Nr. | Topic       |
---:|:------------| 
0.  | [Syllabus](http://rpository.com/ds4psy/) | 
1.  | [Basic R concepts and commands](http://rpository.com/ds4psy/essentials/basics.html) | 
2.  | [Visualizing data](http://rpository.com/ds4psy/essentials/visualize.html) | 
3.  | [Transforming data](http://rpository.com/ds4psy/essentials/transform.html) |
4.  | [Exploring data (EDA)](http://rpository.com/ds4psy/essentials/explore.html) | 
5.  | [Tibbles](http://rpository.com/ds4psy/essentials/tibbles.html) |
6.  | [Importing data](http://rpository.com/ds4psy/essentials/import.html) |
7.  | [Tidying data](http://rpository.com/ds4psy/essentials/tidy.html) |
8.  | [Joining data](http://rpository.com/ds4psy/essentials/join.html) |
9.  | [Functions](http://rpository.com/ds4psy/essentials/function.html) |
+.  | [Datasets](http://rpository.com/ds4psy/essentials/datasets.html) | 
-->

## Course coordinates

<!-- uni.kn logo and link to SPDS: -->  
<!-- ![](./inst/pix/uniKn_logo.png) --> 
<a href="https://www.spds.uni-konstanz.de/">
<img src = "../inst/pix/uniKn_logo.png" alt = "spds.uni.kn" align = "right" width = "300" style = "width: 300px; float: right; border:20;"/>
<!-- <img src = "./inst/pix/uniKn_logo_s.png" alt = "spds.uni.kn" style = "float: right; border:20;"/> --> 
</a>

* Taught at the [University of Konstanz](https://www.uni-konstanz.de/) by [Hansjörg Neth](http://neth.de/) (<h.neth@uni.kn>,  [SPDS](https://www.spds.uni-konstanz.de/), office D507).
* Winter 2018/2019: Mondays, 13:30--15:00, C511. 
* Links to current [course syllabus](http://rpository.com/ds4psy/) | [ZeUS](https://zeus.uni-konstanz.de/hioserver/pages/startFlow.xhtml?_flowId=detailView-flow&unitId=5101&periodId=78&navigationPosition=hisinoneLehrorganisation,examEventOverviewOwn) |  [Ilias](https://ilias.uni-konstanz.de/ilias/goto_ilias_uni_crs_809936.html) 


## Preparations

Create an R script (`.R`) or an R-Markdown file (`.Rmd`) and load the R packages of the `tidyverse`. (**Hint:** Structure your script by inserting spaces, meaningful comments, and sections.) 

```{r layout_template, echo = TRUE, eval = FALSE}
## Functions | ds4psy
## 2019 01 28
## ----------------------------

## Preparations: ----------

library(tidyverse)

## 1. Topic: ----------

# etc.

## End of file (eof). ----------  
```

To use [R Markdown](https://rmarkdown.rstudio.com), create a corresponding file and save it with the `.Rmd` extension (e.g., by selecting `File > New File > R Markdown`). 
For instructions on combining text and code, see [Chapter 27: R Markdown](https://r4ds.had.co.nz/r-markdown.html) of our textbook, or use one of the following templates:  

- minimal template:  `rmd_template_s` [in [.Rmd](http://rpository.com/down/temp/rmd_template_s.Rmd) | [.html](http://rpository.com/down/temp/rmd_template_s.html) format]

- medium template: `rmd_template_m` [in [.Rmd](http://rpository.com/down/temp/rmd_template_m.Rmd) | [.html](http://rpository.com/down/temp/rmd_template_m.html) format]

- explicit explanations: `Rmarkdown_basics` [in [.Rmd](http://rpository.com/down/temp/Rmarkdown_basics.Rmd) | [.html](http://rpository.com/down/temp/Rmarkdown_basics.html) format]

**Hint:** Try to _knit_ your `.Rmd` file immediately after saving it and marvel at the beauty of the resulting `.html`-file. If this works, keep doing this routinely from now on, putting all your R-code into code chunks, and any text (like headings or conclusions) that describes or explains what you are doing outside of them. From now on, you can share your `.html` output files, rather than your `.Rmd` source files when showing off your R and data science skills.


# Functions

We have been using functions in all sessions of this course. Many of them (e.g., `c()`, `max()`, and `mean()`) are included in R (so-called _base R_ functions), and the others (like `mutate()`, `gather()`, and `ggplot()`) were defined in additional packages (e.g., the tidyverse packages `dplyr`, `tidyr`, and `ggplot2`). 

Definition

What is a function?  Mathematically, a mapping between sets, or from values x to y.

In programming: A way to abstract, by writing independent modules (or boxes) that are governed by input-output relations.

## Basics

Structure

Input and Output

## Arguments

Input to a function.

- Required vs. optional/default arguments
- Checking/verifying arguments

## Return values

Output of a function.

## Conditional execution


## Loops


## Style

Use good names (for function and argument), clear formatting.





# Exercises (WPA09)

Here are the exercises of WPA09 and possible solutions for them.

## Exercise 1

#### Conditional feeding

1. Write a function `feed_me` that takes a character string `food` as a required argument, and returns the sentence `"I love to eat ___!"`. 
Test your function by running `feed_me("apples")`, etc.

```{r, eval = FALSE, echo = TRUE}
feed_me <- function(___) {
  
  output <- paste0("I love to eat ", ___, "!")
  
  print(___)
}
```

<!-- Solution: --> 

A possible solution:

```{r ex1_1, echo = TRUE, eval = TRUE}
feed_me <- function(food) {
  
  output <- paste0("I love to eat ", food, "!")
  
  print(output)
  }

# Check:
feed_me("apples")
feed_me("books")
feed_me("cake")
feed_me(NA)
```

2. Modify `feed_me` so that it returns `"Nothing to eat."` when `food = NA`.

<!-- Solution: --> 

A possible solution:

```{r ex1_2, echo = TRUE, eval = TRUE}
feed_me <- function(food) {
  
  if (is.na(food)) {
    output <- "Nothing to eat."
  } else {
    output <- paste0("I love to eat ", food, "!")
  }
  
  print(output)
}

# Check:
feed_me(NA)
feed_me("apples")
feed_me("books")
```

3. Extend your function to `feed_vegan` that uses 2 additional arguments: 

- `type` should be an optional character string, set to a default argument of `"food"`. 
If `type` is not `"food"`, the function should return `"___ is not edible."`. 

- `vegan` should be an optional Boolean value, which is set to `FALSE` by default. 
If `vegan` is `TRUE`, the function should return `"I love to eat ___!"`. 
Otherwise, the function should return `"I do not eat ___."`.

Test your functions with various entries. 

<!-- Solution: --> 

A possible solution:

```{r ex1_3, echo = TRUE, eval = TRUE}
feed_vegan <- function(food, type = "food", vegan = FALSE) {
  
  if (is.na(food)) {
    
    output <- "Nothing to eat."
    
  } else {  # food is not NA: 
    
    if (type != "food") {
      output <- paste0(food, " is not edible.")
    } else {  # type == "food": 
      
      if (vegan) {
        output <- paste0("I love to eat ", food, "!")
      } else {  # vegan 
        output <- paste0("I do not eat ", food, ".")
      }      
    }
  }
  
  print(output)
}

# Check:
feed_vegan(NA)
feed_vegan("veggies", vegan = TRUE)
feed_vegan("R4DS", type = "book")
feed_vegan("meat", vegan = FALSE)
# but:
feed_vegan("spagetti", type = "pasta")  # due to type != "food"
feed_vegan("veggies")  # due to default: vegan = FALSE
```

## Exercise 2

#### Plotting function

1. Write a function `plot_scatter` that takes a table (tibble or data frame) with 2 numeric variables `x` and `y` as `my_data` and plots a scatterplot of the values of `y` by the values of `x`. 

**Hint:** First write a `ggplot` command that creates a scatterplot of `my_data`. Then wrap a function `plot_scatter` around this command that takes `my_data` as its argument.  

Test your function by using the following 2 tibbles `tb_1` and `tb_2` as `my_data`: 

```{r ex2_create_test_data}
set.seed(101)
n_num <- 100
x_val <- runif(n = n_num, min = 30, max = 90)
y_val <- runif(n = n_num, min = 30, max = 90)

tb_1 <- tibble::tibble(x = x_val, y = y_val)
tb_2 <- tibble::tibble(x = x_val, y = x_val + rnorm(n = n_num, mean = 0, sd = 10))

names(tb_1)
```

```{r ex2_1_scatter}
library(tidyverse)

plot_scatter <- function(my_data) {
  
  ggplot(data = my_data) +
    geom_point(aes(x = x, y = y), alpha = .5) +
    labs(title = "My scatterplot", 
         caption = paste0("Data from ", deparse(substitute(my_data)))) +
    theme_bw()
  
}

# Check:
plot_scatter(my_data = tb_1)
plot_scatter(my_data = tb_2)
```

2. For any table `my_data` that contains 2 numeric variables `x` and `y` we can fit a linear model as follows:

```{r ex2_lm}
my_data <- tb_1

my_lm <- lm(y ~ x, data = my_data)
my_lm

# Get the model's intercept and slope values:
my_lm$coefficients[1]  # intercept
my_lm$coefficients[2]  # slope
```

Incorporate a linear model into your `plot_scatter` function by adding a line that shows the prediction of the linear model (in a color that can be set by an optional `col` argument).

```{r ex2_2_lm}
plot_scatter <- function(my_data, col = "red") {

  # fit linear model:
  lm <- lm(y ~ x, data = my_data)
  intercept <- lm$coefficients[1]
  slope <- lm$coefficients[2]  
    
  # plot:
  ggplot(data = my_data) +
    geom_point(aes(x = x, y = y), alpha = .5) +
    geom_abline(intercept = intercept, slope = slope, color = col, lty = 2) + 
    labs(title = "My scatterplot", 
         caption = paste0("Data from ", deparse(substitute(my_data)))) +
    theme_bw()
  
}

# Check:
plot_scatter(my_data = tb_1)
plot_scatter(my_data = tb_2, col = "steelblue")
```


<!-- +++ here now +++ --> 


# More on functions

- Study the vignette `vignette("two-table")` for 2-table verbs, and vignette("dplyr") for 1-table verbs of `dplyr`. 

- See the [RStudio cheatsheet](https://www.rstudio.com/resources/cheatsheets/) on _Data Transformation_ for essential `dplyr` commands. 

- Follow the links on <https://dplyr.tidyverse.org> and [Wikipedia:Join_SQL](https://en.wikipedia.org/wiki/Join_(SQL)) for additional information. 


# Conclusion

<!-- Table with links: -->

All [ds4psy](http://rpository.com/ds4psy/) essentials so far: 

Nr. | Topic       |
---:|:------------| 
0.  | [Syllabus](http://rpository.com/ds4psy/) | 
1.  | [Basic R concepts and commands](http://rpository.com/ds4psy/essentials/basics.html) | 
2.  | [Visualizing data](http://rpository.com/ds4psy/essentials/visualize.html) | 
3.  | [Transforming data](http://rpository.com/ds4psy/essentials/transform.html) |
4.  | [Exploring data (EDA)](http://rpository.com/ds4psy/essentials/explore.html) | 
5.  | [Tibbles](http://rpository.com/ds4psy/essentials/tibbles.html) |
6.  | [Importing data](http://rpository.com/ds4psy/essentials/import.html) |
7.  | [Tidying data](http://rpository.com/ds4psy/essentials/tidy.html) |
8.  | [Joining data](http://rpository.com/ds4psy/essentials/join.html) |
9.  | **Functions** |
+.  | [Datasets](http://rpository.com/ds4psy/essentials/datasets.html) | 

<!--
Nr. | Topic       |
---:|:------------| 
0.  | [Syllabus](http://rpository.com/ds4psy/) | 
1.  | [Basic R concepts and commands](http://rpository.com/ds4psy/essentials/basics.html) | 
2.  | [Visualizing data](http://rpository.com/ds4psy/essentials/visualize.html) | 
3.  | [Transforming data](http://rpository.com/ds4psy/essentials/transform.html) |
4.  | [Exploring data (EDA)](http://rpository.com/ds4psy/essentials/explore.html) | 
5.  | [Tibbles](http://rpository.com/ds4psy/essentials/tibbles.html) |
6.  | [Importing data](http://rpository.com/ds4psy/essentials/import.html) |
7.  | [Tidying data](http://rpository.com/ds4psy/essentials/tidy.html) |
8.  | [Joining data](http://rpository.com/ds4psy/essentials/join.html) |
9.  | [Functions](http://rpository.com/ds4psy/essentials/function.html) |
+.  | [Datasets](http://rpository.com/ds4psy/essentials/datasets.html) | 
-->

[Last update on `r Sys.time()` by [hn](http://neth.de/).]  

<!-- eof. --> 